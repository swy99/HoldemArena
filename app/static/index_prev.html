<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hold'em Arena - Login</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <link rel="manifest" href="/static/manifest.json">
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/static/service-worker.js');
        }
    </script>
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>tailwind.config={theme:{extend:{colors:{primary:'#082616',secondary:'#C8A327',tertiary:'#FFF8E8'},borderRadius:{'none':'0px','sm':'4px',DEFAULT:'8px','md':'12px','lg':'16px','xl':'20px','2xl':'24px','3xl':'32px','full':'9999px','button':'8px'}}}}</script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <style>
        :where([class^="ri-"])::before { content: "\f3c2"; }
        body {
            background-color: #082616;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .card-shadow {
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }
        input:focus {
            outline: none;
            border-color: #FFD700;
        }
        input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #0b6623;
            border-radius: 4px;
            background-color: white;
            position: relative;
        }
        input[type="checkbox"]:checked {
            background-color: #0b6623;
        }
        input[type="checkbox"]:checked::after {
            content: "";
            position: absolute;
            width: 10px;
            height: 5px;
            border-left: 2px solid white;
            border-bottom: 2px solid white;
            top: 4px;
            left: 3px;
            transform: rotate(-45deg);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-[#082616]">
    <main class="flex-1 flex flex-col items-center justify-center px-6 py-6 min-h-screen">
        <div class="flex justify-center w-full mb-8">
            <div class="flex items-center space-x-3">
                <img src="/static/logo_alpha4.png" class="w-20 h-20 object-contain">
                <h1 class="text-white text-3xl font-bold">HOLD'EM<br/>ARENA</h1>
            </div>
        </div>
        <div class="bg-tertiary rounded-lg p-6 w-full max-w-xs card-shadow">
            <h3 class="text-primary text-xl font-semibold mb-6 text-center">Welcome Back</h3>
            <form>
                <div class="mb-5">
                    <label for="id" class="block text-sm font-medium text-gray-700 mb-1">ID</label>
                    <input type="text" id="id" class="w-full px-4 py-3 border-2 border-primary rounded text-sm" placeholder="Enter your ID">
                </div>
                
                <div class="mb-6">
                    <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <input type="password" id="password" class="w-full px-4 py-3 border-2 border-primary rounded text-sm" placeholder="••••••••">
                </div>
                
                <div class="mb-6">
                    <div class="flex flex-wrap items-center justify-between">
                        <!-- <div class="flex items-center">
                            <input type="checkbox" id="remember" class="mr-2">
                            <label for="remember" class="text-sm text-gray-700">Remember me</label>
                        </div>
                        <a href="#" class="text-sm text-primary hover:text-secondary transition-colors cursor-pointer mt-2 w-full text-right">
                            Forgot password?
                        </a> -->
                    </div>
                </div>
                
                
                <button type="submit" class="w-full bg-secondary text-white py-3 rounded-button font-medium hover:bg-opacity-90 transition-colors cursor-pointer !rounded-button">
                    Sign In
                </button>
                <div class="relative flex items-center justify-center my-6">
                    <div class="border-t border-gray-300 w-full"></div>
                    <div class="absolute bg-tertiary px-4 text-sm text-gray-500">or continue with</div>
                </div>
                <button type="button"
                onclick="startGoogleLogin()"
                class="w-full flex items-center justify-center space-x-2 border-2 border-gray-300 bg-white py-3 rounded-button hover:bg-gray-50 transition-colors">
                <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" class="w-5 h-5">
                <span class="text-gray-700">Continue with Google</span>
            </button>
        </form>
        
    </div>
    <div class="mt-6 text-center">
        <p class="text-white text-sm">New to Hold'em Arena? <a href="/static/register.html" class="text-secondary hover:underline cursor-pointer">Create an account</a></p>
    </div>
</main>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const form = document.querySelector('form');
        form.addEventListener('submit', async function (e) {
            e.preventDefault();
            
            const id = document.getElementById('id').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!id || !password) {
                showError("Please fill in all required fields.");
                return;
            }
            
            try {
                const res = await fetch("/api/login", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        id: id,
                        password: password,
                    }),
                });
                
                if (!res.ok) {
                    const data = await res.json();
                    throw new Error(data.detail || "Login failed.");
                }
                
                const { token } = await res.json();
                localStorage.setItem("holdemarena_token", token);
                location.href = "/static/lobby.html";
            } catch (err) {
                showError("Login failed.");
            }
            
        });
        
        function showError(message) {
            const errorModal = document.createElement('div');
            errorModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            errorModal.innerHTML = `
    <div class="bg-white p-6 rounded-lg max-w-xs w-full">
      <h3 class="text-lg font-semibold text-primary mb-2">Error</h3>
      <p class="text-gray-700 mb-4">${message}</p>
      <button class="w-full bg-primary text-white py-2 rounded-button">OK</button>
    </div>`;
            document.body.appendChild(errorModal);
            errorModal.querySelector('button').addEventListener('click', function () {
                errorModal.remove();
            });
        }
    });
    let initialized = false;
    
    function startGoogleLogin() {
        if (!window.google || !google.accounts) {
            alert("Google 로그인 로딩 중입니다. 잠시 후 다시 시도하세요.");
            return;
        }
        
        if (!initialized) {
            google.accounts.id.initialize({
                client_id: "167258769454-vtv9mhvbjse3gtpfp6e3t0q0m1gqgiti.apps.googleusercontent.com",
                callback: handleCredentialResponse,
                cancel_on_tap_outside: false
            });
            initialized = true;
        }
        
        google.accounts.id.prompt((notification) => {
            if (notification.isNotDisplayed()) {
                console.warn("❌ Google 로그인 UI가 표시되지 않았습니다.");
                alert("Google 로그인 창을 표시할 수 없습니다. HTTPS 환경인지, 팝업 차단이 없는지 확인해주세요.");
            }
            if (notification.isSkippedMoment()) {
                console.warn("⏭️ Google 로그인 UI가 자동으로 건너뛰어졌습니다.");
            }
        });
    }
    
    function handleCredentialResponse(response) {
        const id_token = response.credential;
        fetch("/api/google_login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ token: id_token })
        })
        .then(res => res.json())
        .then(data => {
            localStorage.setItem("holdemarena_token", data.token);
            localStorage.setItem("holdemarena_player_id", data.player_id);
            location.href = "/static/lobby.html";
        })
        .catch(err => {
            alert("Google 로그인 실패: " + err.message);
        });
    }
</script>
</body>
</html>